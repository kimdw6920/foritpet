<!DOCTYPE html>
<html>
<head>
    <title>{{ shelter.name }} - í¬ì‡í«</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { border-bottom: 2px solid #ff4d6d; padding-bottom: 10px; margin-bottom: 20px; }
        .info-card { background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .btn-support { background: #ff4d6d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; }
        .schedule-list { list-style: none; padding: 0; }
        .schedule-item { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¾ {{ shelter.name }}</h1>
    </div>

    <div class="info-card">
        <p><strong>ğŸ“ ì£¼ì†Œ:</strong> {{ shelter.address }}</p>
        <p><strong>ğŸ“ ì—°ë½ì²˜:</strong> {{ shelter.phone }}</p>
        <p>{{ shelter.description }}</p>
        <a href="{{ shelter.feed_support_url }}" target="_blank" class="btn-support">ğŸ¥« ì‚¬ë£Œ í›„ì›í•˜ê¸° (ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´)</a>
    </div>

    <h3>ğŸ“… ë´‰ì‚¬í™œë™ ì¼ì •</h3>
    <ul class="schedule-list">
        {% for schedule in shelter.schedules.all %}
        <li class="schedule-item">
            <div>
                <strong>{{ schedule.date }}</strong> 
                (ì¸ì›: {{ schedule.current_participants }} / {{ schedule.max_participants }})
            </div>
            <form action="{% url 'apply_volunteer' schedule.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn-support" {% if schedule.current_participants >= schedule.max_participants %}disabled{% endif %}>
                    ì‹ ì²­í•˜ê¸°
                </button>
            </form>
        </li>
        {% empty %}
        <li>ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</li>
        {% endfor %}
    </ul>
    <script>
        document.querySelectorAll('form').forEach(form => {
            form.onsubmit = async (e) => {
                e.preventDefault(); // 1. í˜ì´ì§€ê°€ í•˜ì–—ê²Œ ë³€í•˜ëŠ” ê²ƒ(ìƒˆë¡œê³ ì¹¨) ë°©ì§€
                
                try {
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: new FormData(form),
                        headers: { 
                            'X-CSRFToken': '{{ csrf_token }}' // ì¥ê³  ë³´ì•ˆ ì²´í¬
                        }
                    });

                    const data = await response.json();

                    if (response.ok) {
                        alert("ğŸ‰ " + data.message); // ì„±ê³µ ì•Œë¦¼
                        location.reload(); // 2. í¬ì¸íŠ¸ì™€ ì¸ì›ì„ í™”ë©´ì— ê°±ì‹ í•˜ê¸° ìœ„í•´ ìƒˆë¡œê³ ì¹¨
                    } else {
                        alert("âš ï¸ " + data.message); // ì‹¤íŒ¨(ì •ì› ì´ˆê³¼ ë“±) ì•Œë¦¼
                    }
                } catch (error) {
                    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•˜ê±°ë‚˜ ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            };
        });
    </script>
</body>
</html>

